# API Endpoints for Order Service

## Bot Management Endpoints

| Endpoint | Method | Description | Request Body | Response Body | Authentication | Error Codes | Notes |
|----------|--------|-------------|--------------|---------------|----------------|-------------|-------|
| `/orders/bots` | POST | Create a new bot | `{ "traderId": string, "botName": string, "strategy": "counter\|limit\|volume\|floating", "exchangeId": string, "typeExchange": "cex\|dex", "pair": string, "base": string, "quote": string, "settings": { "priceRange"?: number, "volumeThreshold"?: number, "hedgeRatio"?: number, "slippage"?: number } }` | `{ "botId": string, "botName": string, "strategy": string, "exchangeId": string, "typeExchange": string, "pair": string, "base": string, "quote": string, "status": "stopped", "createdAt": string }` | API Key or OAuth | 400 (Invalid parameters), 401 (Unauthorized), 429 (Rate limit) | Persists bot in PostgreSQL via libs/order-db. Emits BotCreated event to Kafka. |
| `/orders/bots/{botId}` | GET | Get bot details | None | `{ "botId": string, "botName": string, "strategy": string, "exchangeId": string, "typeExchange": string, "pair": string, "base": string, "quote": string, "status": "working\|stopped\|error", "inactivityTime": string, "error"?: string, "createdAt": string, "updatedAt": string }` | API Key or OAuth | 401 (Unauthorized), 404 (Bot not found), 429 (Rate limit) | Retrieves bot from PostgreSQL. Logs errors via @project/error-handler. |
| `/orders/bots` | GET | List all bots | Query params: ?traderId=123&status=working,stopped&exchangeId=binance&limit=10&offset=0 | `{ "bots": [{ "botId": string, "botName": string, "strategy": string, "exchangeId": string, "typeExchange": string, "pair": string, "base": string, "quote": string, "status": string, "inactivityTime": string, "error"?: string }], "total": number }` | API Key or OAuth | 401 (Unauthorized), 429 (Rate limit) | Fetches bots from PostgreSQL with filtering. Used by frontend for bot management. |
| `/orders/bots/{botId}/start` | POST | Start a bot | None | `{ "botId": string, "status": "working", "startedAt": string }` | API Key or OAuth | 401 (Unauthorized), 404 (Bot not found), 429 (Rate limit) | Updates bot status in PostgreSQL. Emits BotStarted event to Kafka for TraderService. |
| `/orders/bots/{botId}/stop` | POST | Stop a bot | None | `{ "botId": string, "status": "stopped", "stoppedAt": string }` | API Key or OAuth | 401 (Unauthorized), 404 (Bot not found), 429 (Rate limit) | Stops bot, cancels orders, updates PostgreSQL. Emits BotStopped event to Kafka. |

## Order Management Endpoints

| Endpoint | Method | Description | Request Body | Response Body | Authentication | Error Codes | Notes |
|----------|--------|-------------|--------------|---------------|----------------|-------------|-------|
| `/orders/bots/{botId}/orders` | POST | Create an order for a bot | `{ "typeOrder": "market\|limit\|stop\|gtc\|floating", "side": "buy\|sell", "quantity": number, "price"?: number, "volume"?: number, "stopPrice"?: number, "slippage"?: number }` | `{ "orderId": string, "botId": string, "status": "PENDING", "typeOrder": string, "side": string, "quantity": number, "price"?: number, "volume"?: number, "createdAt": string }` | API Key or OAuth | 400 (Invalid parameters), 401 (Unauthorized), 403 (Insufficient balance), 429 (Rate limit) | Validates balance via WalletService, checks price via MarketDataService. Persists in PostgreSQL. Emits OrderCreated event to Kafka. |
| `/orders/bots/{botId}/orders/{orderId}` | GET | Get order details | None | `{ "orderId": string, "botId": string, "status": "PENDING\|OPEN\|PARTIALLY_FILLED\|FILLED\|CANCELED\|FAILED", "typeOrder": string, "side": string, "pair": string, "base": string, "quote": string, "quantity": number, "filledQuantity"?: number, "price"?: number, "volume"?: number, "createdAt": string, "updatedAt"?: string }` | API Key or OAuth | 401 (Unauthorized), 404 (Order not found), 429 (Rate limit) | Fetches order from PostgreSQL, caches in Redis. Used for order tracking. |
| `/orders/bots/{botId}/orders/{orderId}` | PATCH | Amend order | `{ "quantity"?: number, "price"?: number, "volume"?: number, "stopPrice"?: number }` | `{ "orderId": string, "status": "PENDING\|OPEN", "updatedAt": string }` | API Key or OAuth | 400 (Invalid parameters), 401 (Unauthorized), 403 (Invalid state), 404 (Order not found), 429 (Rate limit) | Updates order in PostgreSQL, emits OrderUpdated event to Kafka. Logs changes via @project/error-handler. |
| `/orders/bots/{botId}/orders/{orderId}/cancel` | POST | Cancel a specific order | None | `{ "orderId": string, "status": "CANCELED", "updatedAt": string }` | API Key or OAuth | 401 (Unauthorized), 403 (Invalid state), 404 (Order not found), 429 (Rate limit) | Updates order status in PostgreSQL, emits OrderCanceled event to Kafka. Used by frontend "Cancel" button. |
| `/orders/bots/{botId}/orders/cancel-all` | POST | Cancel all orders for a bot | None | `{ "botId": string, "canceledOrders": [string], "updatedAt": string }` | API Key or OAuth | 401 (Unauthorized), 404 (Bot not found), 429 (Rate limit) | Cancels all bot orders in PostgreSQL, emits OrdersCanceled event to Kafka. Used by "Cancel All Orders" button. |
| `/orders/bots/{botId}/orders` | GET | List orders for a bot | Query params: ?status=PENDING,OPEN&limit=100&offset=0 | `{ "orders": [{ "orderId": string, "status": string, "typeOrder": string, "side": string, "pair": string, "base": string, "quote": string, "quantity": number, "price"?: number, "volume"?: number, "createdAt": string }], "total": number }` | API Key or OAuth | 401 (Unauthorized), 429 (Rate limit) | Fetches orders from PostgreSQL, caches in Redis. Used for "Limit Orders" frontend view. |

## Manual Order & Strategy Endpoints

| Endpoint | Method | Description | Request Body | Response Body | Authentication | Error Codes | Notes |
|----------|--------|-------------|--------------|---------------|----------------|-------------|-------|
| `/orders/manual-orders` | POST | Create a manual order | `{ "traderId": string, "exchangeId": string, "typeExchange": "cex\|dex", "pair": string, "base": string, "quote": string, "typeOrder": "market\|limit\|stop\|gtc\|floating", "side": "buy\|sell", "quantity": number, "price"?: number, "volume"?: number, "slippage"?: number }` | `{ "orderId": string, "status": "PENDING", "typeOrder": string, "side": string, "pair": string, "base": string, "quote": string, "quantity": number, "price"?: number, "volume"?: number, "createdAt": string }` | API Key or OAuth | 400 (Invalid parameters), 401 (Unauthorized), 403 (Insufficient balance), 429 (Rate limit), 500 (Exchange failure) | Validates via WalletService and MarketDataService. Persists in PostgreSQL. Emits ManualOrderCreated event to Kafka. |
| `/orders/manual-orders/{orderId}/execute` | POST | Manually execute an order | `{ "action": "execute\|override", "price"?: number, "volume"?: number }` | `{ "orderId": string, "status": "EXECUTED\|FAILED", "updatedAt": string, "transactionId"?: string }` | API Key or OAuth (Operator role) | 401 (Unauthorized), 403 (Access denied), 404 (Order not found), 429 (Rate limit) | Routes via ProxyManagementService. Updates PostgreSQL, emits OrderExecuted event to Kafka. |
| `/orders/bots/{botId}/execute-strategy` | POST | Execute strategy for a bot | `{ "orderId"?: string, "strategyParams": { "priceRange"?: number, "volumeThreshold"?: number, "hedgeRatio"?: number, "slippage"?: number } }` | `{ "executionId": string, "status": "EXECUTED\|FAILED", "executedAt": string, "details"?: { "counterTradeId"?: string, "volumeExecuted"?: number } }` | API Key or OAuth (Operator role) | 400 (Invalid parameters), 401 (Unauthorized), 403 (Access denied), 429 (Rate limit) | Executes the bot's strategy (Counter, Limit, Volume, Floating). Persists in PostgreSQL, emits StrategyExecuted event to Kafka. |

## Data & Monitoring Endpoints

| Endpoint | Method | Description | Request Body | Response Body | Authentication | Error Codes | Notes |
|----------|--------|-------------|--------------|---------------|----------------|-------------|-------|
| `/orders/market-data` | GET | Fetch market data for orders | Query params: ?pair=ETH/USDT | `{ "pair": string, "base": string, "quote": string, "currentPrice": number, "volume24h": number, "priceChangePercent": number }` | API Key or OAuth | 401 (Unauthorized), 429 (Rate limit), 503 (Service unavailable) | Fetches price data from MarketDataService (cached in Redis). Used for Floating order strategies. |
| `/orders/analytics` | GET | Fetch order analytics | Query params: ?botId=123&status=FILLED | `{ "orders": [{ "orderId": string, "profit": number, "executionTime": number, "status": string }], "totalProfit": number, "successRate": number }` | API Key or OAuth | 401 (Unauthorized), 429 (Rate limit) | Requests data from TradingAnalyticsService via Kafka. Used for performance tracking in frontend. |
| `/orders/health` | GET | Health check | None | `{ "status": "ok", "uptime": number }` | None | 503 (Service unavailable) | Exposes health metrics for Prometheus. Used by APIHealthCheck in local dev. |
| `/orders/metrics` | GET | Service metrics | None | Prometheus format (e.g., order_creation_total 100) | API Key or OAuth | 401 (Unauthorized) | Exposes metrics for Prometheus (e.g., order creation rate, error rate). |

## Internal Functions

The Order Service manages order lifecycles for bots and manual trades, leveraging CCXT for exchange interactions via ProxyManagementService. The key internal functions for sending, processing, modifying, and canceling orders are integrated into the unified `/execute-strategy` endpoint.
